<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>
<?python
    from mootiro_form import __appname__ as appname
    request.page_deps.package('deform')
    request.page_deps.package('jquery.ui')

?>
 <py:def function="logged_head()">
   <style type="text/css">
    a {color: #006b67;}
    a:visited {color: #006b67;}
    a:hover   {color: black;}
   </style>
 </py:def>

  <py:def function="content()">
    <h1 py:content='pagetitle' />
    <p py:if="not request.user">Welcome to ${appname}!<br />
      Let's sign you up:
    </p>
    ${Markup(user_form)}
    <div id="changePassword"/>
    <div id="deleteuserform" style="display:none">
        <p>Do you really want to delete your account? It can't be undone,
            you know...
            <form id='deleteFormTESTE' method='post' action='/user/delete'/>
        </p>
    </div>
    <script type="text/javascript">
        var changePassword = function () {
            $.post('/user/edit_password',
                $('#passwordform').serialize(),
                function (response) {
                    if (response.changed) {
                        $('#changePassword').dialog('close');   
                    } else {
                        $('#changePassword').html(response);
                        $('input[type=password]')[0].focus();
                    }
            }); 
        }

        $('#changePasswordButton').click(function () {
            $('#changePassword').load('/user/edit_password', function () {
            $('#changePassword').dialog({width: 'auto', minHeight: '400px', modal: true,
                    buttons:
                 [{ text: '${_('Change Password')}',
                    click: changePassword }]
            });
});
        });
    </script>
    
    <script type="text/javascript">
    $('#deleteUserButton').click(function() {
        $( "#deleteuserform" ).dialog({
            resizable: false,
            height: 200,
            modal: true,
            buttons: {
                "Delete User": function() {
                   $('#deleteFormTESTE').submit(); 
                   $(this).dialog("close");
                },
                "Cancel": function() {
                    $(this).dialog("close");
                }
            }
        });
    });
    
    </script>
    
  </py:def>

  <xi:include href="master_cover.genshi" />

</html>
