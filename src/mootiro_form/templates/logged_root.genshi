<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>
<?python
    from mootiro_form import __appname__ as appname
    request.page_deps.package('jquery.ui')
    request.page_deps.lib('jquery.tmpl')
    request.page_deps.lib('forms_list')
    request.page_deps.stylesheet('forms_list')
    if forms_data:
        request.page_deps.onload('''
            init_forms_list('{0}', {1}, '#forms_list');
        '''.format(url_root, forms_data))
    else:
        request.page_deps.onload('''
            init_forms_list('{0}', '', '#forms_list');
        '''.format(url_root))

    LT = Markup('<')
?>

<py:def function="logged_head()">
</py:def>

<py:def function="head_content()">
  <script type='text/javascript'
           src="${static_url('mootiro_form:static/js/forms_list.js')}" />
</py:def>
  <py:def function="content()">
    <div id="formsListPage">
        <div id="actionButtons">
            <div id="create_form">
              <a href="${url('form', action='edit', id='new')}">New form
              <img id="newFormIcon" src="${static_url('mootiro_form:static/img/icons-root/newFormIcon.png')}" title="New Form" alt="New Form"/>
              </a>
            </div>
            <div style="clear: both;" />
        </div>
        <div id="confirm-deletion" style="display: none">
            Do you really want to delete the form <span id="form-name" />?
        </div>
        <div id="no-form-message">
            You don't have any forms yet.
        </div>
        <div id="notCategorizedForms">
            Not categorized
        </div>
        <table rules="rows" FRAME="HSIDES" border="1" id="formsListTable">
            <thead>
                <th class="selectAll">
                  <input id="selectAll-input" name='select_all' type='checkbox'/>
                  select all
                </th>
                <th>answers</th>
                <th>edit</th>
                <th>view</th>
                <th>share</th>
                <th>duplicate</th>
                <th>delete</th>
                <th>status</th>
                <th>questions</th>
                <th>created</th>
                <th>last</th>
            </thead>
            <tbody id="forms_list">
            </tbody>
        </table>
        <script id="form_tr" type="text/x-jquery-tmpl">
            <tr>
                <td class="formName">
                    <input type="checkbox" name="select-form-$${form_id}" />
                    <input id="fname-input-$${form_id}" size=""
                      style="display: none; width: 200px;"
                      name="form_name" value="$${form_name}"/>

                    <span id="fname-$${form_id}">
                      {{if form_name.length $LT 25}}
                        $${form_name}
                      {{else}}
                        $${form_name.substring(0, 25)} ...
                      {{/if}}
                    </span>

                    {{if form_description}}
                      <p id="fdescription-$${form_id}">
                        {{if form_description.length $LT 140}}
                          $${form_description}
                        {{else}}
                          $${form_description.substring(0, 140)} ...
                        {{/if}}
                      </p>
                    {{/if}}
                </td>
                <td>
                    <a id="no-entries-$${form_id}">$${form_entries}</a>
                </td>
                <td>
                    <a href="/form/edit/$${form_id}"><img class="edit_button" title="edit" alt="edit"
                    src="${static_url('mootiro_form:static/img/icons-root/edit.png')}"
                    id="edit-form-$${form_id}" /></a>
                </td>
                <td>
                  {{if form_slug}}
                    <a href="/form/view/s/$${form_slug}" target="_blank">
                      <img class="view_button" title="view" alt="view"
                      src="${static_url('mootiro_form:static/img/icons-root/view.png')}"
                      id="view-form-$${form_id}" /></a>
                  {{else}}
                    <img class="view_button" title="publish it to view" alt="publish it to view"
                      src="${static_url('mootiro_form:static/img/icons-root/view.png')}"
                      id="view-form-$${form_id}" />
                  {{/if}}
                </td>
                <td><!-- share --></td>
                <td><!-- duplicate --></td>
                <td>
                    <img class="delete_button" title="delete" alt="delete"
                    src="${static_url('mootiro_form:static/img/icons-root/delete.png')}"
                    id="delete-form-$${form_id}" />
                </td>
                <td><!-- status --></td>
                <td><!-- questions --></td>
                <td>
                    $${form_created}
                </td>
                <td><!-- last edit --></td>
            </tr>
        </script>
    </div>
  </py:def>
  <xi:include href="master_cover.genshi" />
</html>
