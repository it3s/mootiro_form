<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>
<?python
    from mootiro_form import __appname__ as appname
    request.page_deps.package('jquery.ui')
    request.page_deps.lib('jquery.tmpl')
    request.page_deps.lib('forms_list')
    request.page_deps.stylesheet('forms_list')
    if all_data:
         request.page_deps.onload('''
        $(function(){{
            init_forms_list('{0}', {1}, '#categories');
            $("#categories")
            .accordion({{
                header: "h3",
                autoHeight: false,
            }})
            }});  
            '''.format(url_root, all_data))
    else:
        request.page_deps.onload('''
        $(function(){{
            init_forms_list('{0}', '', '#categories');
            $("#categories").accordion();
            }});
            '''.format(url_root))

    LT = Markup('<')
?>

<py:def function="logged_head()">
</py:def>

<py:def function="head_content()">
  <script type='text/javascript'
           src="${static_url('mootiro_form:static/js/forms_list.js')}" />
</py:def>
  <py:def function="content()">
    <div id="formsListPage">
        <div id="actionButtons">
            <div id="create_form">
              <a href="${url('form', action='edit', id='new')}">New form
              <img id="newFormIcon" src="${static_url('mootiro_form:static/img/icons-root/newFormIcon.png')}" title="New Form" alt="New Form"/>
              </a>
            </div>
            <div style="clear: both;" />
        </div>
        <div id="confirm-deletion" style="display: none">
            Do you really want to delete the form <span id="form-name" />?
        </div>
        <div id="no-form-message">
            <a href="${url('form', action='edit', id='new')}">
            You don't have any forms yet!<br />
            Click here to create one.</a>
        </div>
        
            
        <div id="categories">
        </div>
            <script id="category_template" type="text/x-jquery-tmpl">
                <h3 class="FormCategory" ><!-- This part sets the accordion header -->

                    <a href="#" id="field-category-$${category_id}"><span
                    id="cname-$${category_id}">$${category_name}</span></a>
                        <input id="cname-input-$${category_id}" size="" style="display: none;" name="form_name" value="$${form_name}"/>
                
                </h3>                
                <div>
                    {{if forms.length == 0}} 
                    You do not have any forms in this category.
                    {{else}}
                <table rules="rows" FRAME="HSIDES" border="1" id="formsListTable">
                    <thead>
                        <th class="selectAll">
                          <input id="selectAll-input" name='select_all' type='checkbox'/>
                          select all
                        </th>
                        <th>entries</th>
                        <th>edit</th>
                        <th>view</th>
                        <th>share</th>
                        <th>duplicate</th>
                        <th>delete</th>
                        <th>status</th>
                        <th>questions</th>
                        <th>created</th>
                        <th>modified</th>
                    </thead>
                        <tbody id="categoryForms-$${category_id}">
                        </tbody>
                    </table>
                    {{/if}}
                </div>
            </script>
            <script id="form_template" type="text/x-jquery-tmpl">
                <tr id="form-$${form_id}">
                <td class="formName">
                    <input type="checkbox" name="select-form-$${form_id}" />
                    <input id="fname-input-$${form_id}" size=""
                      style="display: none; width: 200px;"
                      name="form_name" value="$${form_name}"/>

                    <span id="fname-$${form_id}">
                      {{if form_name.length $LT 25}}
                        $${form_name}
                      {{else}}
                        $${form_name.substring(0, 25)} ...
                      {{/if}}
                    </span>

                    {{if form_description}}
                      <p id="fdescription-$${form_id}">
                        {{if form_description.length $LT 140}}
                          $${form_description}
                        {{else}}
                          $${form_description.substring(0, 140)} ...
                        {{/if}}
                      </p>
                    {{/if}}
                </td>
                <td>
                    <a id="no-entries-$${form_id}">$${form_entries}</a>
                </td>
                <td>
                    <a href="/form/edit/$${form_id}"><img class="edit_button" title="edit" alt="edit"
                    src="${static_url('mootiro_form:static/img/icons-root/edit.png')}"
                    id="edit-form-$${form_id}" /></a>
                </td>
                <td>
                  {{if form_slug}}
                    <a href="/entry/view_form/s/$${form_slug}" target="_blank">
                      <img class="view_button" title="view" alt="view"
                      src="${static_url('mootiro_form:static/img/icons-root/view.png')}"
                      id="view-form-$${form_id}" /></a>
                  {{else}}
                    <img class="view_button" title="publish it to view" alt="publish it to view"
                      src="${static_url('mootiro_form:static/img/icons-root/view.png')}"
                      id="view-form-$${form_id}" />
                  {{/if}}
                </td>
                <td><!-- share --></td>
                <td><!-- duplicate --></td>
                <td>
                    <img class="delete_button" title="delete" alt="delete"
                    src="${static_url('mootiro_form:static/img/icons-root/delete.png')}"
                    id="delete-form-$${form_id}" />
                </td>
                <td>
                  {{if form_public}}
                    published
                  {{else}}
                    edition
                  {{/if}}
                </td>
                <td>$${form_questions}</td>
                <td>
                    $${form_created}
                </td>
                <td>$${form_modified}</td>
            </tr>
        </script>
    </div>
  </py:def>
  <xi:include href="master_cover.genshi" />
</html>
