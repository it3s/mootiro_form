<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>

<?python
pd = request.page_deps
pd.lib('jquery.tmpl')
pd.lib('jquery-json')
pd.lib('datetimepicker')
pd.lib('date')
pd.package('jquery.ui')
pd.lib('qsort')
pd.package('deform')
pd.stylesheet('form_edit')
icon_url = lambda path: static_url('mootiro_form:static/img/icons-tabs/' + path)
?>

<py:def function="logged_head()">
</py:def>

<py:def function="content()">
  <div id="LeftCol">
    <ul class="ui-tabs-nav">
      <li id="TabForm"><a href='#PanelForm'
          title='Form properties'><img alt='Form'
          src="${icon_url('formSettings.png')}" /></a></li>
      <li id="TabVisual"><a href='#PanelVisual'
          title='Visual properties'><img alt='Visual'
          src="${icon_url('visual.png')}" /></a></li>
      <li id="TabAdd"><a href='#PanelAdd'
          title='Add field'><img alt='Add field'
          src="${icon_url('addField.png')}" /></a></li>
      <li id="TabEdit"><a href='#PanelEdit'
          title='Edit field'><img alt='Edit field'
          src="${icon_url('editField.png')}" /></a></li>
      <li id="TabPublish"><a href='#PanelPublish'
          title='Publish form'><img alt='Publish'
          src="${icon_url('publish.png')}" /></a></li>
    </ul>
    <div id="PanelTitle">Form properties</div>

      <div id='PanelForm' class="ui-tabs-panel">
        <p class='ShortHelp'>Form settings help you to organize your forms.
        The settings can be changed during or after the form creation process.
        </p>
        <div id="PropertiesForm" xml:space="preserve">${Markup(dform)}</div>
      </div>

      <div id='PanelVisual' style="display: none;" class="ui-tabs-panel">
        <p class='ShortHelp'>For the visual finish of your form, you can
        choose from one of our predefined themes or create your own one.</p>
        TODO: Visual editing here
      </div>

      <div id='PanelAdd' style="display: none;" class="ui-tabs-panel">
        <p class='ShortHelp'>Click to add the field to the end of the form.</p>
        <hr />
        <h3>Text</h3>
        <ul id='FieldIcons'>
          <li py:for="ft in all_fieldtypes">
            <img class="${ft.__class__.__name__}Icon"
                 alt="${_(ft.name)}" title="${_(ft.brief)}"
                 src="${ft.icon_url(request)}"
                 onclick="fields.insert('${ft.__class__.__name__}', null, true);"
            />
          </li>
        </ul>
        <hr />
        <h3>Options</h3>
        <hr />
      </div>

      <div id='PanelEdit' style="display: none" class="ui-tabs-panel deform">
        <p class='ShortHelp'>Click on the part of the field you want to edit.</p>
      </div>

      <div id='PanelPublish' style="display: none;" class='ui-tabs-panel deform'>
          <p class='ShortHelp'>Before publishing, you have to decide whether
          this form is open to the public or who will be able to access it.</p>
        <label><input type="checkbox" name="public"
                   checked="${'checked' if form.public else None}"/>
          Make the form public
        </label><br/>
        <span class="metadata">
          This will also create a public link for the form.
        </span><br/><br/>
        Public link<br/>
        <textarea id="form_public_url" readonly="readonly">${url('entry_form_slug', action='view_form', slug=form.slug) if form.slug else 'To see the public link, check the box above and save.'}</textarea>
        <br/><br/>
        <label>Thanks message</label>
        <textarea name="thanks_message"><py:if
            test="form.thanks_message">${form.thanks_message}</py:if></textarea>
        Start Date: <input type="text" id="start_date"
        value="${unicode(form.start_date)[:16]
                 if form.start_date != None else ''}"
        title="If you select a start date the form will be closed until
that day." />
        <p class='error' id='StartDateError'></p>
        <br />
        End Date: <input type="text" id="end_date"
        value="${unicode(form.end_date)[:16]
                 if form.end_date != None else ''}"
        title="If you select an end date the form will be closed after this
date"/>
      <p class='error' id='EndDateError'></p>
      <p class='error' id='IntervalError'></p>
    </div>
    <div id="EditorButtons">
      <div style="float:right;">
        <button id="AddField" title="Add a field">
          <img alt="" src="/static/img/icons-edit/addField.png" /> add field
        </button>
      </div>
      <button id="SaveForm" title="Save your alterations to this form">
        <img alt="" src="/static/img/icons-edit/GreenCheckMark.png" /> save
      </button>
    </div>
  </div>

  <div id='RightCol'>
    <div id="FormDisplay">
      <div id='YourLogo' title='Click to upload your logo'>Your logo here</div>
        <h1>
          <span id="DisplayTitle" title='Click to edit the title'
            onclick="tabs.to('#TabForm');$('#deformField1').focus();"></span>
        </h1>
      <div id="FormDescription">
        <span id="DisplayDescription" class="NewLines"
              title='Click to edit the description'
            onclick="tabs.to('#TabForm');$('#deformField2').focus();"></span>
      </div>
      <ul id='FormFields' title='Click to edit this field' />
      <p id="submitButton" >
        <input id="submit" name="${form.submit_label}" type="submit"
            value="${form.submit_label if form.submit_label else _('Submit')}" />
      </p>
    </div>
  </div>
  <script py:for="ft in all_fieldtypes" type="text/javascript"
          src="${ft.script_url(request)}" />
  <script src="${static_url('mootiro_form:static/js/form_edit.js')}"
          type="text/javascript" />
  <script type="text/javascript">
field_conf_json = ${Markup(fields_config_json)};
fields = new FieldsManager(${form.id or "'new'"}, ${fields_json},
                           ${fieldtypes_json});
  </script>
</py:def>

<xi:include href="master_cover.genshi" />
</html>
