<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>

<?python
pd = request.page_deps
pd.lib('jquery.tmpl')
pd.lib('jquery-json')
pd.lib('jquery.ui')
pd.package('deform')
pd.onload("""
  $(function () {
    $('#saveForm').click(function (e) { fields.persist(); });
    tabs = new Tabs('.ui-tabs-nav', '.ui-tabs-panel');
    setupCopyValue('#deformField1', '#DisplayTitle', 'Form Title');
    setupCopyValue('#deformField2', '#DisplayDescription',
                   'Public Description of your form');
    $('#FormFields').sortable({ placeholder: 'fieldSpace', 
                                forcePlaceholderSize: true,
                                handle: '.moveButton'});
  });
""" )
pd.stylesheet('form_edit')
icon_url = lambda path: static_url('mootiro_form:static/img/icons-tabs/' + path)
?>

<py:def function="logged_head()">
</py:def>

<py:def function="content()">
  <div id="LeftCol">
    <ul class="ui-tabs-nav">
      <li id="TabForm"><a href='#PanelForm'
          title='Form properties'><img alt='Form'
          src="${icon_url('formSettings.png')}" /></a></li>
      <li id="TabVisual"><a href='#PanelVisual'
          title='Visual properties'><img alt='Visual'
          src="${icon_url('visual.png')}" /></a></li>
      <li id="TabAdd"><a href='#PanelAdd'
          title='Add field'><img alt='Add field'
          src="${icon_url('addField.png')}" /></a></li>
      <li id="TabEdit"><a href='#PanelEdit'
          title='Edit field'><img alt='Edit field'
          src="${icon_url('editField.png')}" /></a></li>
      <li id="TabPublish"><a href='#PanelPublish'
          title='Publish form'><img alt='Publish'
          src="${icon_url('publish.png')}" /></a></li>
    </ul>

      <div id='PanelForm' class="ui-tabs-panel">
        <input type="hidden" id="form_id" name="form_id" value="${form.id}"/>
        ${Markup(dform)}
      </div>

      <div id='PanelVisual' class="ui-tabs-panel">
        TODO: Visual editing here
      </div>

      <div id='PanelAdd' class="ui-tabs-panel">
        <div class='Pad'>
          <p class='ShortHelp'>Click on a field to add it to the end of
            the form, or drag it to the proper position on the right.</p>
        </div>
        <hr />
        <h3>Text</h3>
        <ul id='FieldIcons'>
          <li py:for="ft in all_fieldtypes">
            <img alt="${_(ft.name)}" title="${_(ft.brief)}"
                 src="${ft.icon_url(request)}"
                 onclick="fields.insert('${ft.__class__.__name__}');" />
          </li>
        </ul>
        <hr />
        <h3>Options</h3>
        <hr />
      </div>

      <div id='PanelEdit' class="ui-tabs-panel">
        Select a field in order to edit its properties here.
      </div>

      <div id='PanelPublish' class='ui-tabs-panel'>
          TODO: The Publish panel.
      </div>

      <div id="btnSend"><button id="saveForm"
           title="Save your alterations to this form">Save</button></div>
  </div>

  <div id='RightCol'>
    <div id="FormDisplay">
      <div id='YourLogo'>Your logo here</div>
        <h1>
          <span id="DisplayTitle"
            onclick="tabs.to('#TabForm');$('#deformField1').focus();"></span>
        </h1>
      <div id="FormDescription">
        <span id="DisplayDescription"
            onclick="tabs.to('#TabForm');$('#deformField2').focus();"></span>
      </div>
      <ul id='FormFields' />
      <p id="submitButton">
        <input id="submit" name="submit" type="submit" value="Submit" />
      </p>
    </div>
  </div>
  <script src="${static_url('mootiro_form:static/js/form_edit.js')}"
          type="text/javascript" />
  <script type="text/javascript">
      fields = new FieldsManager(${fields_json});
  </script>
  <script py:for="ft in all_fieldtypes" type="text/javascript"
          src="${ft.script_url(request)}" />
</py:def>

<xi:include href="master_cover.genshi" />
</html>
