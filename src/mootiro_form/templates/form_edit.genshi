<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip=''>

<?python
pd = request.page_deps
pd.lib('jquery.tmpl')
pd.lib('jquery-json')
pd.lib('datetimepicker')
pd.lib('date')
pd.package('jquery.ui')
pd.lib('qsort')
pd.package('deform')
pd.stylesheet('form_edit')
icon_url = lambda path: static_url('mootiro_form:static/img/icons-tabs/' + path)
?>

<py:def function="logged_head()">
    <script src="${static_url('mootiro_form:static/lib/transecma.js')}"></script>
</py:def>

<py:def function="content()">
  <div id="OuterContainer">
    <div id="InnerContainer">
      <div id="LeftCol" class="Col">
        <ul class="ui-tabs-nav">
          <li id="TabForm"><a href='#PanelForm'
              title='Form properties'><img alt='Form'
              src="${icon_url('formSettings.png')}" /></a></li>
          <li id="TabVisual"><a href='#PanelVisual'
              title='Visual properties'><img alt='Visual'
              src="${icon_url('visual.png')}" /></a></li>
          <li id="TabAdd"><a href='#PanelAdd'
              title='Add field'><img alt='Add field'
              src="${icon_url('addField.png')}" /></a></li>
          <li id="TabEdit"><a href='#PanelEdit'
              title='Edit field'><img alt='Edit field'
              src="${icon_url('editField.png')}" /></a></li>
        </ul>
        <div id="PanelTitle">Form properties</div>

          <div id='PanelForm' class="ui-tabs-panel">
            <p class='ShortHelp'>Form settings help you to organize your forms.
            The settings can be changed during or after the form creation process.
            </p>
            <div id="PropertiesForm" xml:space="preserve">${Markup(dform)}</div>
          </div>

      <div id='PanelVisual' style="display: none;" class="ui-tabs-panel">
        <p class='ShortHelp'>For the visual finish of your form, you can
        choose from one of our predefined themes or create your own one.</p>
        <div class="OptionBox">
          <h2>Pre-defined design</h2>
          <ul id="SystemTemplatesList">
            <li py:for="st in system_templates" id="${st.system_template_id}">
              <img class="icon" alt="${st.system_template_name}" title="${st.system_template_name}"
                src="/static/img/icons-edit/icons-system_templates/${st.system_template_id}.png" />
              <img class="icon_selected" style="display: none"
                alt="${st.system_template_name}" title="${st.system_template_name}"
                src="/static/img/icons-edit/icons-system_templates/${st.system_template_id}_selected.png" />
            </li>
          </ul>
          <input type="hidden" name="system_template_id"
            value="${form.template.system_template_id if form.template != None else '1'}"/>
        </div>
      </div>

          <div id='PanelAdd' style="display: none;" class="ui-tabs-panel">
            <p class='ShortHelp'>Click to add the field to the end of the form.</p>
            <hr />
            <h3>Text</h3>
            <ul id='FieldIcons'>
              <li py:for="ft in all_fieldtypes">
                <img class="${ft.__class__.__name__}Icon"
                     alt="${_(ft.name)}" title="${_(ft.brief)}"
                     src="${ft.icon_url(request)}"
                     onclick="fields.addField('${ft.__class__.__name__}');"
                />
              </li>
            </ul>
            <hr />
            <h3>Options</h3>
            <hr />
          </div>

          <div id='PanelEdit' style="display: none" class="ui-tabs-panel deform">
            <p class='ShortHelp'>Click on the part of the field you want to edit.</p>
          </div>

        <div id="EditorButtons">
          <div style="float:right;">
            <button id="AddField" title="Add a field">
              <img src="/static/img/icons-edit/addField.png" /> add field
            </button>
          </div>
          <button id="SaveForm" title="Save your alterations to this form">
            <img src="/static/img/icons-edit/CheckmarkGray.png"
            /><img src='/static/img/icons-edit/CheckmarkGreen.png' style='display:none;' /> save
          </button>
          <span id="FormHasBeenSaved">&nbsp;saved.</span>
        </div>
      </div>

      <div id='RightCol' class="Col">
        <div id="FormDisplay">
          <div id='Header'>
            <div id='YourLogo' title='Click to upload your logo'>Your logo here</div>
            <h1 id="DisplayTitle" title='Click to edit the title'
              onclick="tabs.to('#TabForm');$('#deformField1').focus();"></h1>
            <p id="DisplayDescription" class="NewLines"
               title='Click to edit the description'
               onclick="tabs.to('#TabForm');$('#deformField2').focus();"></p>
          </div>
          <ul id='FormFields' title='Click to edit this field' />
          <input id="submit" name="${form.submit_label}" type="submit"
            value="${form.submit_label if form.submit_label else _('Submit')}" />
        </div>
      </div>
    </div>
  </div>

  <script py:for="ft in all_fieldtypes" type="text/javascript"
          src="${ft.script_url(request)}" />
  <script src="${static_url('mootiro_form:static/js/form_edit.js')}"
          type="text/javascript" />
  <script type="text/javascript">
field_conf_json = ${Markup(fields_config_json)};
fields = new FieldsManager(${form.id or "'new'"}, ${Markup(fields_json)},
                           ${fieldtypes_json});
  </script>
</py:def>

<xi:include href="master_cover.genshi" />
</html>
